var cdnCheck={header:"<i class='fa fa-cloud'></i> CDN Installationsprüfung",home:"",blog:"",html:"<form><fieldset><legend><i class='fa fa-tag'>&nbsp;</i><span>Bitte geben Sie den Namen des zu prüfenden Blogs ein</span></legend><p>http://<input id='txtBlogname' type='text' />.twoday.net/<button class='btn' id='btnCheckThisBlog'>Jetzt prüfen!</button></p></fieldset></form>",yep:"&nbsp;&hellip;&nbsp;<i class='fa fa-check'></i>",nope:"&nbsp;&hellip;&nbsp;<i class='fa fa-frown-o'></i>",status:"",result:0,query:"http://query.yahooapis.com/v1/public/yql?q=select%20*%20from%20html%20where%20url%3D%22http%3A%2F%2F:blog:.twoday.net%2F%22%20and%20xpath%3D%22%2F%2Fscript%5Bcontains(%40src%2C'static.twoday.net')%5D%22&format=json",setBlog:function(e){0===e.length?e="Bitte melden Sie sich zuerst bei Twoday an!":e.indexOf(".twoday.net")<0?(this.home="http://"+e+".twoday.net/",this.blog=e,e=this.home):(this.home=e,this.blog=e.match(/http:\/\/(.*).twoday.net/)[1]);var t=$("#btnCheckCDN");t.html(t.html().replace(":blog:",e))},isUserLoggedIn:function(){return 0===this.blog.length?(toastr.info("Bitte melden Sie sich bei Twoday an, um diese Funktion zu nutzen!",this.header),!1):!0},queryBlogname:function(){if(this.isUserLoggedIn()){var e=$("#cdnCheckArea");e.html(this.html).find("input").val(this.blog),$("#btnCheckThisBlog").on("click",function(e){e.preventDefault(),cdnCheck.checkThisBlog()})}},checkThisBlog:function(){var e=$("#txtBlogname").val();return e!==encodeURIComponent(e)?(toastr.error("Es dürfen keine Sonderzeichen im Blognamen vorkommen! Bitte korrigieren Sie Ihre Eingabe!",this.header),!1):(this.blog=e,this.home="http://"+e+".twoday.net/",this.displayStatus(),void 0)},displayStatus:function(){if(this.isUserLoggedIn()){var e=this;e.result=0,toastr.info("Der CDN Installationsstatus wird jetzt überprüft...",e.header),$.getJSON(e.query.replace(":blog:",e.blog),function(t){var s=t.query.count;if(0===s)toastr.error("Das Blog ist nicht existent, nicht öffentlich oder derzeit nicht erreichbar!",e.header);else{for(var i=t.query.results.script,n="",o=0;s>o;o++)n=i[o].src,n.indexOf("jquery.min.js")>0?e.result=1|e.result:n.indexOf("cdnconnect-min-js")>0?e.result=2|e.result:n.indexOf("yepnope154-min-js")>0&&(e.result=4|e.result);e.status=1==(1&e.result)?"jQuery ist aktiviert"+e.yep:"jQuery nicht gefunden"+e.nope,e.status+="<br />",e.status+=2==(2&e.result)?"CDN-Connect ist vorhanden"+e.yep:"CDN-Connect nicht gefunden"+e.nope,3==(3&e.result)?toastr.success(e.status,e.header):toastr.warning(e.status,e.header),7==(7&e.result)?toastr.success("Sie haben bereits Komponenten ausgewählt und erfolgreich aktiviert! Sie können diese jederzeit nutzen.",e.header):3==(3&e.result)?toastr.info("Das CDN wurde erfolgreich eingerichtet. Bitte wählen Sie nun Ihre Wunschkomponenten aus (Schritt 2) und aktivieren Sie diese durch den Aufruf Ihres Blogs (Schritt 3).",e.header):toastr.error("Das CDN ist für das Blog "+e.home+" noch nicht vollständig eingerichtet. Bitte überprüfen Sie die erforderlichen Anpassungen aus Schritt 1.",e.header)}})}}},cdnOfferings={components:[{name:"accordiontabs",cached:!1,selected:!1,settings:!1,root:"","class":9,prio:9,queries:[{key:"Accordion",type:"selector",item:".accComponent:first"},{key:"Tabs",type:"selector",item:"ul.tabs:first"}],requiredBy:[],load:"'#cdnTwoday/accordiontabs-min-css.css', '#cdnTwoday/accordiontabs-min-js.js'",complete:""},{name:"articletotop",cached:!1,selected:!1,settings:!1,root:"","class":1,prio:5,queries:[{key:"ArticleToTop",type:"selector",item:"#articleToTop"}],requiredBy:[],load:"'#cdnTwoday/articletotop-min-js.js'",complete:""},{name:"audio2day",cached:!0,selected:!1,settings:!0,root:"","class":3,prio:9,queries:[{key:"AudioPlayer",type:"selector",item:".audio"}],requiredBy:[],load:"'#cdnTwoday/audio2day-min-css.css', '#cdnTwoday/audio2day-min-js.js'",init:"{strPlay: 'Wiedergabe', strPause: 'Pause', strVolume: 'Lautstärke'}",complete:"if (siteNeeds.audio2day){ siteCached.$AudioPlayer.audioPlayer( #settings ); }"},{name:"awesomeeditor",cached:!0,selected:!1,settings:!0,root:"","class":3,prio:4,queries:[{key:"AwesomeEditor",type:"selector",item:"#content .formText"}],requiredBy:[],load:"'#cdnTwoday/awesomeeditor-min-css.css', '#cdnTwoday/awesomeeditor-min-js.js'",init:"{awesomeEditorWidth: '586', awesomeEditorTopOffset: -48}",complete:"if (siteNeeds.awesomeeditor) { siteCached.$AwesomeEditor.markItUp( #settings ); }"},{name:"awesomeeditorcore",cached:!1,selected:!0,settings:!1,root:"","class":3,prio:3,queries:[],requiredBy:[],load:"'#cdnTwoday/awesomeeditorcore-min-css.css'",complete:""},{name:"backstretch",cached:!1,selected:!1,settings:!0,root:"","class":1,prio:2,queries:[{key:"Backstretch",type:"selector",item:".usesBackstretch:first"}],requiredBy:[],load:"'#cdnTwoday/backstretch204-min-js.js'",init:"$.backstretch('https://googledrive.com/host/0B87rILW4RVIJNlN3eUJxVWN5ZWM/bg/atSunset@majownik.jpg', {centeredX: true, centeredY: true, duration: 5000, fade: 0} );",complete:"if (siteNeeds.backstretch) { #settings }"},{name:"chosen",cached:!0,selected:!1,settings:!0,root:"","class":3,prio:9,queries:[{key:"ChosenSelect",type:"selector",item:".chosen-select"}],requiredBy:[],load:"'#cdnCflare/chosen/1.1.0/chosen.min.css', '#cdnCflare/chosen/1.1.0/chosen.jquery.min.js'",init:"{disable_search_threshold: 10, width: '70%', no_results_text: 'Oops, keine Ergebnisse!', placeholder_text_multiple: 'Bitte Optionen wählen...', placeholder_text_single: 'Bitte eine Option auswählen...'}",complete:"if (siteNeeds.chosen) { siteCached.$ChosenSelect.chosen( #settings ); }"},{name:"commentform",cached:!1,selected:!1,settings:!1,root:"","class":9,prio:9,queries:[{key:"CommentForm",type:"selector",item:"form[name=editForm]:first"}],requiredBy:[],load:"'#cdnTwoday/commentform-min-js.js'",complete:""},{name:"fontawesome",cached:!1,selected:!1,settings:!1,root:"","class":1,prio:0,queries:[{key:"FontAwesome",type:"selector",item:".fa:first"},{key:"Foundt5Used",type:"code",item:"this.foundation || false"},{key:"AccTabsUsed",type:"code",item:"this.accordiontabs || false"},{key:"AEditorUsed",type:"code",item:"this.awesomeeditor || false"},{key:"SharingUsed",type:"code",item:"siteCached.$StoryShare.length>0 || false"}],requiredBy:["accordiontabs","awesomeeditor","foundation","storyshare"],load:"'#cdnTwoday/fontawesome403-min-css.css'",complete:""},{name:"foundation",cached:!1,selected:!1,settings:!0,root:"","class":2,prio:0,queries:[],requiredBy:[],load:"'<% site.skin name='googleDrive' %>css/foundation/foundation2day522.min.css', '<% site.skin name='googleDrive' %>js/foundation/foundation2day522.min.js'",init:"{validateDataAttribs: true, initFoundation5: { topbar: {is_hover: !Modernizr.touch, mobile_show_parent_link: false}, orbit:  {animation: 'slide', timer_speed: 6000, resume_on_mouseout: false, animation_speed: 500, slide_number: true, bullets: false, next_on_click: true}}}",complete:"if (siteNeeds.foundation) { $('[title^=data-]').foundation2day().init( #settings ); $('#preloadAnimation').fadeOut(); $('#preloadWrapper').delay(350).fadeOut('slow'); }"},{name:"googledrive",cached:!0,selected:!1,settings:!0,root:"","class":1,prio:6,queries:[{key:"GoogleDrive",type:"selector",item:".googledrive"}],requiredBy:[],load:"'#cdnTwoday/gdimages-min-js.js'",init:"{gdRootFolder: '/host/0B87rILW4RVIJNlN3eUJxVWN5ZWM', gdSubFolder: '', addClass: 'neonimg th', titleContent: 'keep'}",complete:"if (siteNeeds.googledrive) { siteCached.$GoogleDrive.gdImages().init( #settings ); }"},{name:"inlinestyles",cached:!0,selected:!0,settings:!1,root:"","class":3,prio:2,queries:[{key:"InlineStyles",type:"selector",item:"style"}],requiredBy:["storyscript"],load:"",complete:"if (siteNeeds.inlinestyles) { siteCached.$InlineStyles.each(function(){ var me=$(this); me.text(me.text().replace(/<br \\/>/gi,'')); }) }"},{name:"isotope",cached:!0,selected:!1,settings:!0,root:"","class":9,prio:9,queries:[{key:"Isotope",type:"selector",item:"#isotope"}],requiredBy:[],load:"'#cdnTwoday/isotope1525-min-js.js'",init:"{containerClass: 'content', itemSelector: '.story', layoutMode: 'masonry'}",complete:"if (siteNeeds.isotope) { siteCached.$Isotope.isotope( #settings ); }"},{name:"jquery",cached:!1,selected:!0,settings:!1,root:"","class":1,prio:1,queries:[{key:"jQuery",type:"function",item:"if(typeof jQuery !== 'undefined'){ x=$.fn.jquery.split('.');y=parseInt(x[0])*100+parseInt(x[1]) } else { y=0 }; return(y<109);"}],requiredBy:[],load:"'//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js'",complete:""},{name:"sidebartotop",cached:!1,selected:!1,settings:!1,root:"","class":1,prio:4,queries:[{key:"SidebarToTop",type:"selector",item:".sidebarToTop:first"}],requiredBy:[],load:"'#cdnTwoday/sidebartotop-min-js.js'",complete:""},{name:"snippet",cached:!0,selected:!1,settings:!1,root:"","class":3,prio:9,queries:[{key:"PreHtml",type:"selector",item:"pre.html"},{key:"PreCss",type:"selector",item:"pre.css"},{key:"PreJs",type:"selector",item:"pre.js"}],requiredBy:[],load:"'#cdnTwoday/snippet-min-css.css', '#cdnTwoday/snippet-min-js.js'",complete:"var param={style:'golden',showNum:false,clipboard:'#cdnTwoday/ZeroClipboard.swf'}; if (siteCached.$PreHtml.length>0){ siteCached.$PreHtml.snippet('html',param); } if (siteCached.$PreCss.length>0){ siteCached.$PreCss.snippet('css',param); } if (siteCached.$PreJs.length>0){ siteCached.$PreJs.snippet('javascript',param); }"},{name:"storyscript",cached:!0,selected:!1,settings:!1,root:"","class":3,prio:1,queries:[{key:"StoryScript",type:"selector",item:".storyScript"}],requiredBy:[],load:"'#cdnTwoday/storyscript-min-js.js'",complete:"if (siteNeeds.storyscript) { siteCached.$StoryScript.storyScript().init(); }"},{name:"storyshare",cached:!0,selected:!1,settings:!0,root:"","class":3,prio:9,queries:[{key:"StoryShare",type:"selector",item:".storyShare"}],requiredBy:[],load:"'#cdnTwoday/storyshare-min-css.css', '#cdnTwoday/storyshare-min-js.js'",init:"{storyUrl: '<% site.url %>', storyTitle: '<% site.title %>', imgUrl: '<% staticURL %><% site.alias %>/images/pinterest.jpg'}",complete:"if (siteNeeds.storyshare) { siteCached.$StoryShare.storyShare().init( #settings ); }"},{name:"swipebox",cached:!0,selected:!1,settings:!0,root:"","class":9,prio:9,queries:[{key:"Swipebox",type:"selector",item:".swipebox"}],requiredBy:[],load:"'#cdnTwoday/ios-orientationchange-fix-js.js', '#cdnTwoday/swipebox-min-css.css', '#cdnTwoday/swipebox-min-js.js'",init:"{hideBarsOnMobile: true, hideBarsDelay: 3000}",complete:"if (siteNeeds.swipebox) { siteCached.$Swipebox.swipebox( #settings ); }"},{name:"timeago",cached:!0,selected:!1,settings:!0,root:"","class":9,prio:9,queries:[{key:"TimeAgo",type:"selector",item:".timeago"}],requiredBy:[],load:"'#cdnCflare/jquery-timeago/1.4.0/jquery.timeago.min.js'",init:"{allowPast: true, allowFuture: false, localeTitle: false, cutoff: 0, strings: {prefixAgo: 'vor', prefixFromNow: 'in', suffixAgo: '', suffixFromNow: '', inPast: 'gerade eben', seconds: 'wenigen Sekunden', minute: 'etwa einer Minute', minutes: '%d Minuten', hour: 'etwa einer Stunde', hours: '%d Stunden', day: 'etwa einem Tag', days: '%d Tagen', month: 'etwa einem Monat', months: '%d Monaten', year: 'etwa einem Jahr', years: '%d Jahren', wordSeparator: ' ', numbers: [] } }",complete:"if (siteNeeds.timeago) { siteCached.$TimeAgo.timeago( #settings ); }"},{name:"tipsy",cached:!0,selected:!1,settings:!0,root:"","class":9,prio:9,queries:[{key:"Tipsy",type:"selector",item:"[rel=tipsy]"}],requiredBy:[],load:"'#cdnTwoday/tipsy-min-css.css', '#cdnTwoday/tipsy-min-js.js'",init:"{fade: true, gravity: 's'}",complete:"if (siteNeeds.tipsy) { siteCached.$Tipsy.tipsy( #settings ); }"},{name:"toastr",cached:!1,selected:!0,settings:!0,root:"","class":1,prio:3,queries:[],requiredBy:[],load:"'#cdnTwoday/toastr201-min-css.css', '#cdnTwoday/toastr201-min-js.js'",init:"{closeButton: true}",complete:"toastr.options = #settings;"},{name:"unslider",cached:!0,selected:!1,settings:!0,root:"","class":3,prio:9,queries:[{key:"Unslider",type:"selector",item:".banner"}],requiredBy:[],load:"'#cdnTwoday/event-move-swipe-min-js.js', '#cdnTwoday/unslider-min-css.css', '#cdnTwoday/unslider-min-js.js'",init:"{speed: 800, delay: 4000, keys: true, dots: true}",complete:"if (siteNeeds.unslider) { siteCached.$Unslider.unslider( #settings ); }"},{name:"videoplayer",cached:!0,selected:!1,settings:!1,root:"","class":3,prio:5,queries:[{key:"VideoPlayer",type:"selector",item:".html5video"}],requiredBy:[],load:"",complete:""},{name:"videojs",cached:!1,selected:!1,settings:!1,root:"videoplayer","class":3,prio:6,queries:[{key:"VideoJS",type:"code",item:"siteCached.$VideoPlayer.hasClass('other') || false"}],requiredBy:[],load:"'#cdnTwoday/video43-min-css.css', '#cdnTwoday/video43-min-js.js'",complete:""},{name:"video2day",cached:!1,selected:!1,settings:!0,root:"videoplayer","class":3,prio:6,queries:[{key:"Video2Day",type:"code",item:"siteCached.$VideoPlayer.length>0 || false"}],requiredBy:[],load:"'#cdnTwoday/video2day-min-js.js'",init:"{addFlexVideoClass: true}",complete:"if (siteNeeds.video2day) { siteCached.$Video2Day.init( #settings ); }"}],selectedComponents:[],amendedComponents:[],cdns:{twoday:"<% staticURL %>cdn/files",cflare:"http://cdnjs.cloudflare.com/ajax/libs"},settings:[],cached:[],needs:[],yepnopes:[],selectComponent:function(e,t){e.selected&&(this.selectedComponents.push((100*e.class+e.prio).toString()+e.name),t&&this.amendedComponents.push(e.name))},markItemsAsSelected:function(e){var t,s=this;s.selectedComponents.length=0,$.each(s.components,function(t,i){i.selected||(i.selected=$.inArray(i.root.length>0?i.root:i.name,e)>=0),i.loadAlways=i.selected&&0===i.queries.length,s.selectComponent(i)}),$.each(s.components,function(e,i){i.selected||($.each(i.requiredBy,function(e,n){return t=s.components.filter(function(e){return e.name===n})[0],t.loadAlways?(i.selected=i.loadAlways=!0,!1):(i.selected=i.selected||t.selected||!1,void 0)}),s.selectComponent(i,"amend"))}),s.selectedComponents.sort()},assembleSettings:function(e){this.settings.push("{'"+e.name+"': { 'status': 'initial', 'settings': '"+e.init||"'}}")},assembleCached:function(e){var t=this;$.each(e.queries,function(e,s){"selector"===s.type&&t.cached.push("$"+s.key+": $('"+s.item+"')")})},assembleNeeds:function(e){var t,s,i=this,n=[];switch($.each(e.queries,function(t,i){switch(i.type){case"selector":s=e.cached?"(siteCached.$"+i.key+".length>0)":"($('"+i.item+"').length>0)",n.push(s);break;case"code":n.push("("+i.item+")");break;case"function":n.push("(function(){"+i.item+"})")}}),s=e.name+": ",t=e.loadAlways?0:n.length){case 0:s+="true";break;case 1:s+=n[0];break;default:s+="function(){ return "+n.join(" || ")+"};"}i.needs.push(s)},assembleYepnopes:function(e){var t=this,s=e.load.length>0,i="{ ";i+=s?"test: siteNeeds."+e.name+",\n  yep: [ "+e.load+" ]":"",e.complete.length>0&&(i+=(s?",\n  ":"")+"complete: function(){ "+e.complete.replace(/#Settings/gi,"siteSettings."+e.name+".settings")+" }"),i+="\n}",t.yepnopes.push(i)},generateParams:function(){var e,t,s=this;s.settings.length=0,s.cached.length=0,s.needs.length=0,s.yepnopes.length=0,$.each(s.selectedComponents,function(i,n){t=n.substr(3,n.length-3),e=s.components.filter(function(e){return e.name===t})[0],e.settings&&s.assembleSettings(e),e.cached&&s.assembleCached(e),(e.load.length>0||e.complete.length>0)&&(s.assembleNeeds(e),s.assembleYepnopes(e))}),s.amendedComponents.length>0&&toastr.info("Auf der Basis Ihrer Auswahl wurden folgende CDN-Komponenten automatisch ergänzt: <b>"+s.amendedComponents.join(", ")+"</b>",cdnCoreInfo.cdnHeader)},insertParams:function(e){return e.replace(/#Settings/i,this.settings.join(",\n")).replace(/#Cached/i,this.cached.join(", ")).replace(/#Needs/i,this.needs.join(",\n")).replace(/#Yepnopes/i,this.yepnopes.join(",\n")).replace(/#cdnTwoday/gi,this.cdns.twoday).replace(/#cdnCflare/gi,this.cdns.cflare).replace(/&lt;/gi,"<").replace(/&gt;/gi,">")}},cdnStorage={data:{date:"",action:"",status:"",script:""},isLocalStorageSupported:function(){return localStorage?!0:(toastr.error("Sorry, Ihr Browser ist veraltet und unterstützt die notwendigen CDN-Funktionen nicht! Bitte aktualisieren Sie Ihre Software und verwenden Sie einen modernen Browser (z.B. Chrome oder Firefox)!",cdnCoreInfo.cdnHeader),!1)},writeLocalStorage:function(){var e=cdnCoreInfo.userName;if(0===e.length)return toastr.info("Bitte melden Sie sich bei Twoday an, um diese Funktion zu nutzen!",cdnCoreInfo.cdnHeader),!1;if(!this.isLocalStorageSupported)return!1;try{return localStorage.setItem(e,JSON.stringify(this.data)),!0}catch(t){return toastr.error("Fehler beim Speichern der cdnTwoday-Daten ("+t.message+")",cdnCoreInfo.cdnHeader),!1}},saveCDN:function(e,t){var s=this.data,i=new Date;return s.date=i.toGMTString(),s.action=e,s.status="<div id='cdnStatus' style='display:none'>CDN "+("Remove"===e?"removed ":"updated ")+s.date+"</div>\n",s.script=t,this.writeLocalStorage()}},cdnYepnope={getInitialScript:function(){return"&lt;script type='text/javascript' src='http://static.twoday.net/cdn/files/yepnope154-min-js.js'&gt;&lt;/script&gt;\n&lt;script type='text/javascript'&gt;\n$(document).ready(function(){\nvar\nsiteSettings = #Settings,\n\nsiteCached = {#Cached},\n\nsiteNeeds = {#Needs};\n\nyepnope([\n#Yepnopes ]);\n});\n&lt;/script&gt;"},markSelected:function(){var e=[];return $("input[type=checkbox]:checked").each(function(t,s){e.push(s.value)}),e.length>0&&cdnOfferings.markItemsAsSelected(e),e.length},generateScript:function(){if(0===this.markSelected())toastr.warning("Sie haben keine Komponenten ausgewählt - Ihr Blog bleibt unverändert.",cdnCoreInfo.cdnHeader);else{cdnOfferings.generateParams();var e=cdnOfferings.insertParams(this.getInitialScript());cdnStorage.saveCDN("CreateOrUpdate",e)&&toastr.success("Der Auftrag zur Aktivierung der gewählten CDN-Elemente in Ihrem Blog wurde erfolgreich gespeichert!",cdnCoreInfo.cdnHeader)}},removeScript:function(){cdnStorage.saveCDN("Remove","")&&toastr.success("Der Auftrag zur Entfernung des CDN aus Ihrem Blog wurde erfolgreich gespeichert!",cdnCoreInfo.cdnHeader)}};$(document).ready(function(){"use strict";cdnCheck.setBlog(cdnCoreInfo.userUrl),$("#btnCheckCDN").click(function(e){e.preventDefault(),cdnCheck.displayStatus()}),$("#btnOtherBlog").click(function(e){e.preventDefault(),cdnCheck.queryBlogname()}),$("#btnMarkAll").click(function(e){e.preventDefault(),$("input[type=checkbox]").prop("checked",!0)}),$("#btnMarkNone").click(function(e){e.preventDefault(),$("input[type=checkbox]").prop("checked",!1)}),$("#btnMostWanted").click(function(e){e.preventDefault(),$("input[type=checkbox]").prop("checked",!1),$("label.mostWanted input[type=checkbox]").prop("checked",!0)}),$("#btnActivateCDN").click(function(e){e.preventDefault(),cdnYepnope.generateScript()}),$("#btnRemoveCDN").click(function(e){e.preventDefault(),cdnYepnope.removeScript()})});